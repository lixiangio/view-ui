import{defineComponent as Z,shallowRef as ne,getCurrentInstance as oe,reactive as le,ref as g,nextTick as B,createApp as ae,resolveComponent as F,openBlock as d,createBlock as L,normalizeClass as y,withCtx as T,createVNode as O,createElementVNode as u,normalizeStyle as G,Transition as W,createElementBlock as v,Fragment as I,createCommentVNode as z,resolveDynamicComponent as re,renderList as X,toDisplayString as S,createTextVNode as R,withModifiers as ce,pushScopeId as ue,popScopeId as pe,onMounted as fe,withDirectives as de,unref as D,vShow as he}from"/libs/vue.js";import k,{instances as h,baseURL as me,Lang as Q,importApp as U,widths as C,minAppWidith as $,getLevel as P,events as H,Langs as ve,getChildOptions as J,urlHistory as N}from"/libs/view.js";import{controlbar as M,overview as j,addHistory as ge,appsState as V,apps as w,controllerSwitch as ye}from"/libs/state.js";import x,{DisableEvent as we,MaskStyle as ee,isTouch as Y,screenHeight as ke}from"/libs/pointer.js";import{open as Ce,openBlank as $e,closeInstance as be}from"/libs/navigator.js";import Se,{IFrame as ze}from"/libs/components.js";import{getRightBaseLine as _}from"/libs/swiper.js";import{message as K}from"/libs/viewui.js";import Le from"/libs/router.js";import{S as Ae}from"../../Index2.js";import{_ as te}from"../../export-helper.js";function Ie(e){const t=new x(e);let s="",r;t.on("start",n=>{if(s="",r=void 0,"validity"in n.target)return we();for(const i in h){r=h[i];return}k.instance=r}),t.on("lock",()=>{if(r&&t.dir==="Y")if(M.value===!1&&r.displays===!1)s="scroll";else{s="drag",ee.cursor="move",t.lastX=t.startX,t.lastY=t.startY,Object.assign(r.$el.style,{zIndex:100,transition:"unset"}),t.initLeft=r.left;for(const n in h){const i=h[n];i!==r&&Object.assign(i.$el.style,{zIndex:"",transition:""})}}});let a;Y===!1&&(t.on("lock",n=>{if(s==="scroll"){let i=n.target;for(;i;){if(i.classList.contains("scroll-y")){a=i;break}const{parentElement:o}=i;if(o)i=o;else{a=i;break}}a.classList.add("scrollbar")}}),t.on("vertical",n=>{if(s==="scroll"&&a){const{move:i}=t;if(i)a.scrollBy(0,-i);else{const{screenY:o}=n;o===0?a.scrollBy(0,16):o===ke&&a.scrollBy(0,-16)}}}),t.on("end",()=>{s==="scroll"&&a&&(a.classList.remove("scrollbar"),a=void 0)})),t.on("end",()=>{if(s==="drag"){const{style:n}=r.$el;Object.assign(n,{transition:""})}}),t.on("click",({target:n})=>{j.value?(j.value=!1,e.style.transformOrigin=`${t.clientX}px 50%`):n.getAttribute("event")==="mask"?M.value=!M.value:n===e&&(M.value=!1)}),k.appsPointer=t}const E=ve({QRCode:{en:"Scan Code",zh:"\u4E8C\u7EF4\u7801"},split:{en:"Split Mode",zh:"\u5206\u5C4F\u6A21\u5F0F"},single:{en:"Single Mode",zh:"\u5355\u5C4F\u6A21\u5F0F"},autoScreen:{en:"Auto",zh:"\u81EA\u9002\u5E94"},fullScreen:{en:"Fullscreen",zh:"\u5168\u5C4F\u663E\u793A"},copy:{en:"Copy Link",zh:"\u590D\u5236\u94FE\u63A5"},newTab:{en:"New Tab",zh:"\u5728\u65B0\u6807\u7B7E\u9875\u4E2D\u6253\u5F00"},reload:{en:"Reload",zh:"\u5237\u65B0"},back:{en:"Back",zh:"\u8FD4\u56DE"},share:{en:"Share",zh:"\u5206\u4EAB"},close:{en:"Close App",zh:"\u5173\u95ED\u5E94\u7528"},drag:{en:"Drag up and down to sort",zh:"\u4E0A\u4E0B\u62D6\u52A8\u6392\u5E8F"}}),Me={100:C[100],200:C[200],300:C[300],400:C[400],500:C[500]},Be=Z({components:{IFrame:ze},props:["options"],setup({options:e}){const{app:t}=e,{split:s=!1,level:r=100,style:a={}}=t,n=ne(void 0),{ctx:i}=oe();return{app:t,langs:E,levels:Me,overview:j,controlbar:M,style:le(a),single:g(!0),split:g(s),splitSwitch:g(!1),level:g(r),displays:g(!1),isInit:g(!1),reload:g(!0),loading:g(!0),maskComponent:n,buttons:[{icon:"ficon-reload",name:E.reload,action(){i.onreload()}},{icon:"ficon-erweima",name:E.QRCode,action(){i.openMask("common/qrcode")}},{icon:"ficon-link",name:E.copy,action(){i.oncopy()}},{icon:"ficon-icons_send",name:E.share,action(){i.openMask("common/share")}}]}},computed:{href(){const{url:e}=this.options;return`${me}/#${e}`}},methods:{open:Ce,openBlank:$e,async oncopy(){navigator.clipboard?(await navigator.clipboard.writeText(this.href),K.success(Q({en:`Copy Success\b ${this.href}`,zh:`\u590D\u5236\u6210\u529F\b ${this.href}`}))):K.error(Q({en:"Copy Failed",zh:"\u590D\u5236\u5931\u8D25"}))},onclose(){be(this)},timeouCloseResize(){const e=Y?3e3:1200;clearTimeout(this.clearTimeouId),this.clearTimeouId=setTimeout(()=>this.displays=!1,e)},clearResizeTimeouID(){clearTimeout(this.clearTimeouId)},closeResizeView(e){this.controlbar?this.controlbar=!1:e.target===e.currentTarget&&(this.displays=!1)},drawer(){this.controlbar=!0},openMask(e){U(e).then(t=>this.maskComponent=t)},closeMask(){this.maskComponent=void 0},setWidth(e){let s=_()-(this.left+e),r=e-this.width;s<0?r+=s:s=0,this.width=e,this.$el.style.width=`${e}px`;for(const a in h){const n=h[a];n.left>this.left?n.left+=r:n.left+=s;const{style:i}=n.$el;i.transition=""}},setLevel(e){const t=C[e];this.level=Number(e);const s=this.level/100-1;this.setWidth(t+s)},onSplit(e){this.single||(this.split=e,e?this.setLevel(this.$refs.mount.childElementCount*100):(this.level=100,this.setWidth($)))},fullScreen(){const[e]=k.initOptions.apps.padding,s=_()-e,r=e-this.left,a=r-(this.width-s);this.width=s,this.level=P(s),this.$el.style.width=`${s}px`;for(const n in h){const i=h[n],{style:o}=i.$el;i.left<=this.left?i.left+=r:i.left+=a,o.transition=""}},autoScreen(){let e=100;const{app:t}=this;t.iframe?t.level&&(e=t.level):this.split&&(e=this.$refs.mount.childElementCount*100),this.level=e;const s=C[e],r=this.width-s;this.width=s,this.$el.style.width=`${s}px`;for(const a in h){const n=h[a],{style:i}=n.$el;n.left>this.left&&(n.left-=r),i.transition=""}},autoAlign(){const e=_(),[t]=k.initOptions.apps.padding;t+this.width===e?this.autoScreen():this.fullScreen()},initResize(){let e=0;const{style:t}=this.$el,s=new x(this.$refs.resize,{angle:20});Y===!1&&s.on("start",()=>ee.display=""),s.on("lock",()=>{s.dir==="X"&&(clearTimeout(this.clearTimeouId),e=this.$el.clientWidth,t.transition="unset",this.originlLeft=this.left,this.displays=!0)}),s.on("level",()=>{const{move:a}=s;e-=a;const n=this.originlLeft-this.left;if(e>$){if(n===0)for(const i in h){const o=h[i];o.left>this.left&&(o.left+=a);const{style:c}=o.$el;c.transition="unset"}else{const i=this.left+this.width,o=s.current-i;e=s.current-this.originlLeft;for(const c in h){const f=h[c];f.left>this.left?f.left+=o:f.left+=n;const{style:l}=f.$el;l.transition="unset"}}if(t.width=`${e}px`,this.level=P(e),this.width=e,this.single===!1){const{children:i}=this.$refs.mount;for(const o of i){const c=String(P(o.clientWidth));c!==o.getAttribute("level")&&o.setAttribute("level",c)}}}else{const i=Math.ceil(Math.abs((e-$)/15))||1;if(this.width!==$){this.level=100;const o=$-this.width,f=(a-o)/i,l=f+o;e=$,t.width=`${$}px`,this.width=$;for(const p in h){const m=h[p];m.left>this.originlLeft?m.left+=l:m.left+=f;const{style:A}=m.$el;A.transition="unset"}}}}),s.on("vertical",a=>{}),s.on("end",()=>{s.dir==="X"&&(this.originlLeft-this.left,this.timeouCloseResize())});let r=0;s.on("click",a=>{this.displays=!0,this.controlbar=!1,this.timeouCloseResize(),a.timeStamp-r<300&&this.autoAlign(),r=a.timeStamp})},async onreload(){this.reload=!1,this.loading=!0,await B(),this.reload=!0,await B(),this.createApp&&this.createApp()},onIFrameLoad(e){this.loading=!1,e(this)}},async mounted(){await B(),this.initResize();let e=C[this.level];const t=_(),{options:s,app:r}=this;if(this.left=0,r.flex===!0){const n=C[400],i=t-this.left;i<n?e=i:e=n}this.width=e;const{style:a}=this.$el;if(a.opacity=0,a.width=`${e}px`,a.transition="unset",requestAnimationFrame(()=>{a.opacity=1,a.transition=""}),h[s.url]=this,r.src){const n=await U(r.src);if(n.app){Object.assign(r,n.app);const{name:f,color:l,icon:p}=n.app;f&&(s.name=f),l&&(s.color=l),p&&(s.icon=p)}this.isInit=!0;const{level:i}=this;let o;const c={instance:this,level:i};if(n.install===void 0){const{pages:f}=n,{style:l}=r;if(f){let{paths:p}=s;p?p.shift():p=[],o={entry:n,pages:f,paths:p,style:l},this.single=!1;let m=!1;for(const A in f){const{__asyncLoader:q,inline:se}=f[A];q?q().then(ie=>{m===!1&&ie.inline===void 0&&(m=!0,this.split=!0,this.splitSwitch=!0)}):se===void 0&&(m=!0)}m&&(this.split=!0,this.splitSwitch=!0),Object.assign(c,Ae)}else this.split=!1,Object.assign(c,n),l&&Object.assign(this.style,l);await B(),this.createApp=()=>{this.loading=!1;const p=ae(c,o);p.use(Se);const m=this.$refs.mount,A=new Le({app:p,options:s,el:m,container:this});this.router=A,p.provide("container",this),p.provide("router",A),this.pages=p.mount(m)}}else await B(),this.createApp=()=>{this.loading=!1;const f=this.$refs.mount;n.install(f,{app:this})};this.createApp()}ge(s),k.initComponentPromise&&(await k.initComponentPromise,k.initComponentPromise=void 0),H.emit("opened",s)}});const b=e=>(ue("data-v-55870cf8"),e=e(),pe(),e),Ee=["level"],Fe={class:"view-resize"},Te=b(()=>u("i",{class:"ficon-auto"},null,-1)),Re=b(()=>u("i",{class:"ficon-fullscreen"},null,-1)),De=b(()=>u("i",{class:"ficon-pages_outlined"},null,-1)),_e=b(()=>u("i",{class:"ficon-fenping1"},null,-1)),Oe=b(()=>u("div",{class:"view-mask",event:"mask"},null,-1)),We={class:"header item"},je={class:"title"},Ve=["title"],Pe=b(()=>u("i",{class:"ficon-xinchuangkou"},null,-1)),Ne=[Pe],Xe={key:1,class:"button"},Ye=b(()=>u("i",{class:"ficon-up"},null,-1)),He=[Ye],qe={class:"buttons"},Ge=["onClick"],Qe=b(()=>u("i",{class:"ficon-cha"},null,-1)),Ue=[Qe];function Je(e,t,s,r,a,n){const i=F("resize"),o=F("container"),c=F("IFrame"),f=F("app");return d(),L(f,{class:y({overview:e.overview})},{default:T(()=>[O(i,{ref:"resize"},null,512),u("view",{class:y({loading:e.loading}),style:G(e.style)},[e.reload?(d(),L(W,{key:0,name:"fade",appear:""},{default:T(()=>[e.app.src?(d(),v(I,{key:0},[e.isInit?(d(),v(I,{key:0},[e.single?(d(),L(o,{key:0,class:"mount scroll-y",level:e.level,ref:"mount",onBack:e.onclose},null,8,["level","onBack"])):(d(),v("div",{key:1,class:y(["mount",[e.split?"flat":"fixed"]]),ref:"mount",onBack:t[0]||(t[0]=(...l)=>e.onclose&&e.onclose(...l))},null,34))],64)):z("",!0)],64)):e.app.iframe?(d(),L(c,{key:1,src:e.app.iframe,gesture:e.app.gesture,onLoad:e.onIFrameLoad},null,8,["src","gesture","onLoad"])):z("",!0)]),_:1})):z("",!0),O(W,{name:"fade",appear:""},{default:T(()=>[e.maskComponent?(d(),L(re(e.maskComponent),{key:0,onClose:t[1]||(t[1]=l=>e.maskComponent=void 0)},null,32)):z("",!0)]),_:1}),u("div",{class:y({controlbar:e.controlbar,displays:e.displays}),onMouseenter:t[11]||(t[11]=(...l)=>e.clearResizeTimeouID&&e.clearResizeTimeouID(...l)),onMouseleave:t[12]||(t[12]=(...l)=>e.timeouCloseResize&&e.timeouCloseResize(...l))},[u("div",{class:"view-display",onClick:t[7]||(t[7]=(...l)=>e.closeResizeView&&e.closeResizeView(...l))},[u("div",{class:"view-levels",onClick:t[2]||(t[2]=l=>e.setLevel(l.target.getAttribute("level")))},[(d(!0),v(I,null,X(e.levels,(l,p)=>(d(),v("div",{key:p,level:p,class:y({active:p<=e.level})},S(p)+"% ",11,Ee))),128))]),u("div",Fe,[u("div",{class:"auto-resize",onClick:t[3]||(t[3]=(...l)=>e.autoScreen&&e.autoScreen(...l))},[Te,R(" "+S(e.langs.autoScreen),1)]),u("div",{class:"full-screen",onClick:t[4]||(t[4]=(...l)=>e.fullScreen&&e.fullScreen(...l))},[Re,R(" "+S(e.langs.fullScreen),1)])]),e.splitSwitch?(d(),v("div",{key:0,class:y(["view-mode",{split:e.split}])},[u("div",{class:"single-mode",onClick:t[5]||(t[5]=l=>e.onSplit(!1))},[De,R(" "+S(e.langs.single),1)]),u("div",{class:"split-mode",onClick:t[6]||(t[6]=l=>e.onSplit(!0))},[_e,R(" "+S(e.langs.split),1)])],2)):z("",!0)]),Oe,u("div",{class:"view-drawer",onClick:t[9]||(t[9]=(...l)=>e.drawer&&e.drawer(...l))},[u("div",We,[u("div",je,[e.app.icon?(d(),v("i",{key:0,class:y(e.app.icon),style:G({color:e.app.color})},null,6)):z("",!0),u("span",null,S(e.app.name),1)]),e.controlbar?(d(),v("div",{key:0,class:"button",title:e.langs.newTab,onClick:t[8]||(t[8]=l=>e.openBlank(e.options.url))},Ne,8,Ve)):(d(),v("div",Xe,He))]),u("div",qe,[(d(!0),v(I,null,X(e.buttons,({name:l,icon:p,action:m})=>(d(),v("div",{class:"button",onClick:m},[u("i",{class:y(p)},null,2),u("span",null,S(l),1)],8,Ge))),256))])]),u("div",{class:"close",onClick:t[10]||(t[10]=ce((...l)=>e.onclose&&e.onclose(...l),["stop"]))},Ue)],34)],6)]),_:1},8,["class"])}const Ke=te(Be,[["render",Je],["__scopeId","data-v-55870cf8"]]);H.on("opening",(e,t,s)=>{V.value===!1&&(V.value=!0)});H.on("closing",e=>{const{$el:t,options:s,left:r}=e;Object.assign(t.style,{opacity:0,zIndex:-1,transition:""});const a=w.indexOf(s);w.splice(a,1)});const Ze=Z({__name:"index",setup(e){const t=g(!1),{initOptions:s}=k,{apps:r}=s;s.app&&w.push(s);const{urls:a}=r;if(a)for(const o of a){const c=J(o);c&&!w.includes(c)&&(c.paths=o.split("/"),w.push(c))}if(r.padding===void 0&&(r.padding=[3,0]),N&&N.length)for(const o of N){const c=J(o);c&&!w.includes(c)&&(c.paths=o.split("/"),w.push(c))}w.length===0&&(V.value=!1);const n=g();fe(()=>{const o=n.value;k.$apps=o,Ie(o),localStorage.guideState===void 0&&setTimeout(()=>t.value=!0,2e3)});function i(o){"validity"in o.target||(o.preventDefault(),ye())}return(o,c)=>{const f=F("Guide");return d(),v(I,null,[O(W,{name:"fade"},{default:T(()=>[de(u("section",{class:y(["apps split",{control:D(M),overview:D(j)}]),ref_key:"$apps",ref:n,onContextmenu:i},[(d(!0),v(I,null,X(D(w),l=>(d(),L(Ke,{key:l.url,options:l},null,8,["options"]))),128))],34),[[he,D(V)]])]),_:1}),O(W,{name:"fade",appear:""},{default:T(()=>[t.value?(d(),L(f,{key:0,onClose:c[0]||(c[0]=l=>t.value=!1)})):z("",!0)]),_:1})],64)}}});const ut=te(Ze,[["__scopeId","data-v-f2d308b8"]]);export{ut as default};

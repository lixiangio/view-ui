import{_ as M}from"../index.js";import{defineComponent as C,ref as z,reactive as D,onMounted as B,createApp as R,unref as L,openBlock as x,createElementBlock as $,normalizeStyle as F,createCommentVNode as V,Fragment as P,createBlock as b,renderList as S,resolveDynamicComponent as j}from"/view-ui/libs/vue.js";import m,{importModeComponent as W,events as A,instances as h,addRootStyleVar as q,importComponent as k,getAppOptions as H,extendsOptions as N,UA as T,urls as U}from"/view-ui/libs/view.js";import{appsState as E,apps as O,controlbar as G,addHistory as J}from"/view-ui/libs/state.js";import K from"/view-ui/libs/components.js";import{_ as Q}from"../export-helper.js";import{getRightBaseLine as X,getMinMove as Y}from"/view-ui/libs/swiper.js";import{getLastPointer as Z}from"/view-ui/libs/pointer.js";import"/view-ui/libs/viewui.js";import"/view-ui/libs/network.js";const I=["src"],tt=C({__name:"Main",setup(d){const{iframe:r,src:e,style:o}=m.initOptions.main,p=z("mount"),n=D({...o});return typeof e=="string"&&B(()=>{W(e).then(s=>{const{app:i}=s;if(i&&i.style&&Object.assign(n,i.style),s.install)s.install(p.value);else{const t=R(s);t.use(K),t.mount(p.value)}})}),(s,i)=>L(r)?(x(),$("iframe",{key:0,src:L(r),frameborder:"0"},null,8,I)):L(e)?(x(),$("main",{key:1,style:F(n),ref_key:"mount",ref:p},null,4)):V("",!0)}});const et=Q(tt,[["__scopeId","data-v-c569c346"]]);function w(d){const{style:r}=d.$el;r.transition="all 0.1s",r.transform=`translate3d(${d.left}px, 20px, 0)`,d.$el.addEventListener("transitionend",()=>{r.transform=`translate3d(${d.left}px, 0, 0)`},{once:!0})}A.on("opening",(d,r,e)=>{var p;E.value===!1&&(E.value=!0);const o=Z()===m.appsPointer?m.instance:void 0;if(e){const n=m.initOptions.apps,{float:s="left",padding:[i]}=n;if(o){if(o===e)return;requestAnimationFrame(()=>{const t=e.left,l=e.width,_=o.left;if(t<_){const v=_-l,a=_-(i+l),y=a>0?0:-a;if(v===t)y?m.swiper.scroll(y):w(e);else for(const u in h){const c=h[u],{style:f}=c.$el;f.zIndex=1,c.left>t&&c.left<_?c.left-=l:c===e&&(f.zIndex="",c.left=v),c.left+=y,f.transition="",f.transform=`translate3d(${c.left}px, 0, 0)`}}else{const v=X(),a=_+o.width,y=a+e.width;let u=v-y;if(u>0&&(u=0),t===a)u?m.swiper.scroll(u):w(e);else for(const c in h){const f=h[c],{style:g}=f.$el;g.zIndex=1,f.left>_&&f.left<t?f.left+=l:f===e&&(f.left=a,g.zIndex=""),f.left+=u,g.transition="",g.transform=`translate3d(${f.left}px, 0, 0)`}}})}else{let t;s==="left"?t=i:t=window.innerWidth-n.padding[1]-2-e.width;const l=t-e.left;l?requestAnimationFrame(()=>{m.swiper.scroll(l)}):w(e)}(p=e.router)==null||p.open(d)}else r.referer=o});A.on("closing",d=>{const{$el:r,options:e,left:o}=d;Object.assign(r.style,{opacity:0,zIndex:-1,transition:"",transform:`translate3d(${o-100}px, 0, 0)`});const{container:p,move:n}=Y();if(p){const s=d.width;if(p.left<o)for(const i in h){const t=h[i];t.left>o&&(t.left-=s),t.left+=n;const{style:l}=t.$el;l.transition="",l.transform=`translate3d(${t.left}px, 0, 0)`}else for(const i in h){const t=h[i];t.left<o&&(t.left+=s),t.left+=n;const{style:l}=t.$el;l.transition="",l.transform=`translate3d(${t.left}px, 0, 0)`}}r.addEventListener("transitionend",s=>{if(s.target===r&&s.propertyName==="transform"){const i=O.indexOf(e);O.splice(i,1),O.length===0&&(E.value=!1,G.value=!1)}})});const mt=C({__name:"index",setup(d){A.on("vive.init",n=>p(n));function r(){const n=sessionStorage[m.pathname];if(n){const s=n.split(",");for(const i of s){const t=U[i];t&&J(t)}}}const e=z(!1),o=D([]);function p(n){n.var&&q(n.var);const{name:s,main:i,apps:t,custom:l,split:_}=n;if(s&&(document.title=`${s} - ${n.brand}`),e.value===!0)return;i?(i.style&&Object.assign(document.body.style,i.style),e.value=!0):l&&k(l.src).then(a=>o.push(a)),t&&(t.float==="fixed"?M(()=>import("./fixed/index.js"),["platform/split/fixed/index.js","platform/export-helper.js"]).then(a=>o.push(a.default)):M(()=>import("./float/index.js"),["platform/split/float/index.js","platform/index.js","platform/export-helper.js"]).then(a=>o.push(a.default)));const v=[];for(const a in _){const y=_[a];if(y){const{src:u}=y;u&&v.push(k(u).then(c=>o.push(c)))}}v.length&&(m.initComponentPromise=Promise.all(v)),r()}return m.initDataPromise.then(n=>{const s=H(m.pathname);m.initOptions=N(s),p(s)}),T==="Firefox"&&document.addEventListener("dragstart",n=>n.preventDefault()),(n,s)=>(x(),$(P,null,[e.value?(x(),b(et,{key:0})):V("",!0),(x(!0),$(P,null,S(o,i=>(x(),b(j(i)))),256))],64))}});export{mt as default};

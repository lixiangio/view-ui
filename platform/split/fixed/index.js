import{defineComponent as D,resolveComponent as $,openBlock as u,createElementBlock as m,Fragment as C,createVNode as M,Transition as T,withCtx as L,normalizeStyle as R,withModifiers as J,createBlock as v,resolveDynamicComponent as Y,normalizeProps as K,guardReactiveProps as Z,createCommentVNode as y,createElementVNode as p,inject as pe,getCurrentInstance as le,shallowReactive as he,shallowRef as de,reactive as fe,ref as w,nextTick as F,createApp as me,normalizeClass as P,renderList as Q,toDisplayString as z,createTextVNode as W,pushScopeId as ve,popScopeId as ge,onMounted as ye,withDirectives as be,unref as N,vShow as $e}from"/view-ui/libs/vue.js";import g,{instances as f,addStyle as H,asyncComponent404 as we,baseURL as ke,Lang as x,importModeComponent as ee,widths as _,minAppWidith as A,getLevel as q,events as Pe,Langs as _e,getChildOptions as te,urlHistory as G}from"/view-ui/libs/view.js";import{controlbar as B,overview as X,openApp as Ce,addHistory as Le,apps as I,appsState as se,controllerSwitch as Ae}from"/view-ui/libs/state.js";import ae,{DisableEvent as Se,MaskStyle as re,isTouch as U,screenHeight as ze}from"/view-ui/libs/pointer.js";import{open as Ie,openBlank as Me,closeInstance as Ee}from"/view-ui/libs/navigator.js";import Be,{IFrame as Te}from"/view-ui/libs/components.js";import{getRightBaseLine as V}from"/view-ui/libs/swiper.js";import{message as ie}from"/view-ui/libs/viewui.js";import Fe from"/view-ui/libs/router.js";import{_ as O}from"../../export-helper.js";function Re(e){const t=new ae(e);let i="",n;t.on("start",s=>{if(i="",n=void 0,"validity"in s.target)return Se();for(const o in f){n=f[o];return}g.instance=n}),t.on("lock",()=>{if(n&&t.dir==="Y")if(B.value===!1&&n.displays===!1)i="scroll";else{i="drag",re.cursor="move",t.lastX=t.startX,t.lastY=t.startY,Object.assign(n.$el.style,{zIndex:100,transition:"unset"}),t.initLeft=n.left;for(const s in f){const o=f[s];o!==n&&Object.assign(o.$el.style,{zIndex:"",transition:""})}}});let l;U===!1&&(t.on("lock",s=>{if(i==="scroll"){let o=s.target;for(;o;){if(o.classList.contains("scroll-y")){l=o;break}const{parentElement:a}=o;if(a)o=a;else{l=o;break}}l.classList.add("scrollbar")}}),t.on("vertical",s=>{if(i==="scroll"&&l){const{scrollTop:o}=l,{move:a}=t;if(a)l.scroll(0,o-a);else{const{screenY:c}=s;c===0?l.scroll(0,o+16):c===ze&&l.scroll(0,o-16)}}}),t.on("end",()=>{i==="scroll"&&l&&(l.classList.remove("scrollbar"),l=void 0)})),t.on("end",()=>{if(i==="drag"){const{style:s}=n.$el;Object.assign(s,{transition:""})}}),t.on("click",({target:s})=>{X.value?(X.value=!1,e.style.transformOrigin=`${t.clientX}px 50%`):s.getAttribute("event")==="mask"?B.value=!B.value:s===e&&(B.value=!1)}),g.appsPointer=t}function ne(e,t,i){H(t);const{app:n,pages:l}=t;if(n){const{style:s,transition:o="fade"}=n;i.style=s,i.transition=o}l&&e&&(i.inlinePage=l[e])}const De=D({props:["page","paths","attrs"],data(){const[e,...t]=this.paths,i={subPaths:t,open:!1,style:void 0,inlinePage:void 0,transition:void 0},{page:n}=this;return n.__asyncLoader===void 0?ne(e,n,i):n.__asyncLoader().then(l=>ne(e,l,this)),i},methods:{back(){const{$parent:e}=this;e.inlinePage=void 0,e.subPaths=[]}},watch:{paths(e){const{app:t,pages:i}=this.page;if(this.style=t?t.style:null,i){const[n,...l]=e,s=i[n];if(s){H(s),this.subPaths=l,this.inlinePage=s;return}}this.subPaths=[],this.inlinePage=void 0}},mounted(){this.open=!0}});function Oe(e,t,i,n,l,s){const o=$("Inline",!0);return u(),m(C,null,[M(T,{name:e.transition,onAfterLeave:e.back},{default:L(()=>[e.open?(u(),m("div",{key:0,class:"page scroll-y",style:R(e.style),onBack:t[0]||(t[0]=J(a=>e.open=!1,["stop"]))},[(u(),v(Y(e.page),K(Z(e.attrs)),null,16))],36)):y("",!0)]),_:1},8,["name","onAfterLeave"]),e.inlinePage?(u(),v(o,{key:0,page:e.inlinePage,paths:e.subPaths},null,8,["page","paths"])):y("",!0)],64)}const je=O(De,[["render",Oe],["__scopeId","data-v-3d7f364b"]]);function oe(e,t,i){H(t),i.open=!0;const{app:n,pages:l}=t;i.style=n?n.style:null,l&&e&&(i.splitPage=l[e])}const We=D({inject:["container"],props:["page","paths","attrs"],data(){const[e,...t]=this.paths,i={subPaths:t,level:100,open:!1,style:void 0,splitPage:void 0,subAttrs:void 0,currentAttrs:void 0};e?i.subAttrs=this.attrs:i.currentAttrs=this.attrs;const{page:n}=this;return n.__asyncLoader?n.__asyncLoader().then(l=>oe(e,l,this)):oe(e,n,i),i},methods:{afterLeave(){const{$parent:e}=this;e.splitPage=void 0,e.subPaths=[]}},watch:{paths(e){const[t,...i]=e,{app:n,pages:l}=this.page;if(this.style=n?n.style:null,t&&l){const s=l[t];if(s){H(s),this.subAttrs=this.attrs,this.subPaths=i,this.splitPage=s;return}else this.currentAttrs=this.attrs}else this.currentAttrs=this.attrs;this.subPaths=[],this.splitPage=void 0}},mounted(){const{container:e}=this;e.app.flex===!0?e.app.flex=!1:this.splitPage===void 0&&e.split&&this.$nextTick(()=>{const t=e.$refs.mount.childElementCount*100;t>e.level&&e.setLevel(t)})},unmounted(){if(this.splitPage===void 0){const{container:e}=this;if(e.split){const t=e.$refs.mount.childElementCount*100;t<e.level&&e.setLevel(t)}}}});function Ne(e,t,i,n,l,s){const o=$("container"),a=$("Child",!0);return u(),m(C,null,[M(T,{name:"fade",onAfterLeave:e.afterLeave},{default:L(()=>[e.open?(u(),v(o,{key:0,class:"child-container",style:R(e.style),level:e.level},{default:L(()=>[p("div",{class:"page scroll-y",onBack:t[0]||(t[0]=J(c=>e.open=!1,["stop"]))},[(u(),v(Y(e.page),K(Z(e.currentAttrs)),null,16))],32)]),_:1},8,["style","level"])):y("",!0)]),_:1},8,["onAfterLeave"]),e.splitPage?(u(),v(a,{key:0,paths:e.subPaths,page:e.splitPage,attrs:e.subAttrs},null,8,["paths","page","attrs"])):y("",!0)],64)}const Ve=O(We,[["render",Ne],["__scopeId","data-v-614d1212"]]),Xe=D({props:["entry","pages","paths","style"],components:{Inline:je,Child:Ve},setup({paths:e,pages:t}){const[i,...n]=e;pe("router").pagesInstance=le().ctx;const l={subPaths:n,attrs:void 0,subAttrs:void 0,splitPage:void 0,inlinePage:void 0};if(i){const s=t[i];s?s.inline===!0?l.inlinePage=s:l.splitPage=s:(l.subPaths=[],l.splitPage=we)}return he(l)},methods:{router(e,t){const{pages:i}=this,[n,...l]=e,s=i[n];s?(this.subAttrs=t,this.subPaths=l,s.__asyncLoader?s.__asyncLoader().then(o=>{i[n]=o,s.inline===!0?this.inlinePage=o:this.splitPage=o}):s.inline===!0?this.inlinePage=s:this.splitPage=s):(this.subPaths=[],this.attrs=t,this.subAttrs=void 0,this.inlinePage=void 0,this.splitPage=void 0)}}});const Ye={class:"page scroll-y"};function He(e,t,i,n,l,s){const o=$("Inline"),a=$("container"),c=$("Child");return u(),m(C,null,[M(a,{class:"entry-container",style:R(e.style),level:"100"},{default:L(()=>[p("div",Ye,[(u(),v(Y(e.entry),K(Z(e.attrs)),null,16))]),e.inlinePage?(u(),v(o,{key:0,page:e.inlinePage,paths:e.subPaths,attrs:e.subAttrs},null,8,["page","paths","attrs"])):y("",!0)]),_:1},8,["style"]),e.splitPage?(u(),v(c,{key:0,page:e.splitPage,paths:e.subPaths,attrs:e.subAttrs},null,8,["page","paths","attrs"])):(u(),v(a,{key:1,class:"child-container empty"}))],64)}const qe=O(Xe,[["render",He],["__scopeId","data-v-0c412e30"]]),E=_e({QRCode:{en:"Scan Code",zh:"\u4E8C\u7EF4\u7801"},split:{en:"Split Mode",zh:"\u5206\u5C4F\u6A21\u5F0F"},single:{en:"Single Mode",zh:"\u5355\u5C4F\u6A21\u5F0F"},autoScreen:{en:"Auto",zh:"\u81EA\u9002\u5E94"},fullScreen:{en:"Fullscreen",zh:"\u5168\u5C4F\u663E\u793A"},multi:{en:"Multiple",zh:"\u590D\u5236\u5E94\u7528"},copy:{en:"Copy Link",zh:"\u590D\u5236\u94FE\u63A5"},newTab:{en:"New Tab",zh:"\u5728\u65B0\u6807\u7B7E\u9875\u4E2D\u6253\u5F00"},reload:{en:"Reload",zh:"\u5237\u65B0"},back:{en:"Back",zh:"\u8FD4\u56DE"},share:{en:"Share",zh:"\u5206\u4EAB"},close:{en:"Close App",zh:"\u5173\u95ED\u5E94\u7528"},drag:{en:"Drag up and down to sort",zh:"\u4E0A\u4E0B\u62D6\u52A8\u6392\u5E8F"}}),Ge={100:_[100],200:_[200],300:_[300],400:_[400],500:_[500]},Qe=D({components:{IFrame:Te},props:["options"],setup({options:e}){const{app:t}=e,{split:i=!1,level:n=100,style:l={}}=t,s=de(void 0),{ctx:o}=le();return{app:t,langs:E,levels:Ge,overview:X,controlbar:B,style:fe(l),single:w(!0),split:w(i),splitSwitch:w(!1),level:w(n),displays:w(!1),init:w(!1),reload:w(!0),loading:w(!0),maskComponent:s,buttons:[{icon:"ficon-reload",name:E.reload,action(){o.onreload()}},{icon:"ficon-copy",name:E.multi,action(){o.onmulti()}},{icon:"ficon-erweima",name:E.QRCode,action(){o.openMask("mask/qrcode")}},{icon:"ficon-link",name:E.copy,action(){o.oncopy()}},{icon:"ficon-icons_send",name:E.share,action(){o.openMask("mask/share")}}]}},computed:{href(){const{url:e}=this.options;return`${ke}/#${e}`}},methods:{open:Ie,openBlank:Me,onmulti(){this.multiId?this.multiId++:this.multiId=1;const e={...this.options,referer:this};e.url+=`?mid=${this.multiId}`,Ce(e)},async oncopy(){navigator.clipboard?(await navigator.clipboard.writeText(this.href),ie.success(x({en:`Copy Success\b ${this.href}`,zh:`\u590D\u5236\u6210\u529F\b ${this.href}`}))):ie.error(x({en:"Copy Failed",zh:"\u590D\u5236\u5931\u8D25"}))},onclose(){Ee(this)},timeouCloseResize(){const e=U?3e3:1200;clearTimeout(this.clearTimeouId),this.clearTimeouId=setTimeout(()=>this.displays=!1,e)},clearResizeTimeouID(){clearTimeout(this.clearTimeouId)},closeResizeView(e){this.controlbar?this.controlbar=!1:e.target===e.currentTarget&&(this.displays=!1)},drawer(){this.controlbar=!0},openMask(e){ee(e).then(t=>this.maskComponent=t)},closeMask(){this.maskComponent=void 0},context(){return this},setWidth(e){let i=V()-(this.left+e),n=e-this.width;i<0?n+=i:i=0,this.width=e,this.$el.style.width=`${e}px`;for(const l in f){const s=f[l];s.left>this.left?s.left+=n:s.left+=i;const{style:o}=s.$el;o.transition=""}},setLevel(e){const t=_[e];this.level=Number(e);const i=this.level/100-1;this.setWidth(t+i)},onSplit(e){this.single||(this.split=e,e?this.setLevel(this.$refs.mount.childElementCount*100):(this.level=100,this.setWidth(A)))},fullScreen(){const[e]=g.initOptions.apps.padding,i=V()-e,n=e-this.left,l=n-(this.width-i);this.width=i,this.level=q(i),this.$el.style.width=`${i}px`;for(const s in f){const o=f[s],{style:a}=o.$el;o.left<=this.left?o.left+=n:o.left+=l,a.transition=""}},autoScreen(){let e=100;const{app:t}=this;t.iframe?t.level&&(e=t.level):this.split&&(e=this.$refs.mount.childElementCount*100),this.level=e;const i=_[e],n=this.width-i;this.width=i,this.$el.style.width=`${i}px`;for(const l in f){const s=f[l],{style:o}=s.$el;s.left>this.left&&(s.left-=n),o.transition=""}},autoAlign(){const e=V(),[t]=g.initOptions.apps.padding;t+this.width===e?this.autoScreen():this.fullScreen()},initResize(){let e=0,t=0;const{style:i}=this.$el,n=new ae(this.$refs.resize,{angle:20});U===!1&&n.on("start",()=>re.display=""),n.on("lock",()=>{n.dir==="X"&&(clearTimeout(this.clearTimeouId),e=this.$el.clientWidth,i.transition="unset",this.originlLeft=this.left,this.displays=!0)}),n.on("level",()=>{const{move:s}=n;e-=s;const o=this.originlLeft-this.left;if(e>A){if(o===0)for(const a in f){const c=f[a];c.left>this.left&&(c.left+=s);const{style:d}=c.$el;d.transition="unset"}else{const a=this.left+this.width,c=n.current-a;e=n.current-this.originlLeft;for(const d in f){const r=f[d];r.left>this.left?r.left+=c:r.left+=o;const{style:h}=r.$el;h.transition="unset"}}if(i.width=`${e}px`,this.level=q(e),this.width=e,this.single===!1){const{children:a}=this.$refs.mount;for(const c of a){const d=String(q(c.clientWidth));d!==c.getAttribute("level")&&c.setAttribute("level",d)}}}else{const a=Math.ceil(Math.abs((e-A)/15))||1;if(this.width===A)g.swiper.move(s/a);else{this.level=100;const c=A-this.width,r=(s-c)/a,h=r+c;e=A,i.width=`${A}px`,this.width=A;for(const b in f){const k=f[b];k.left>this.originlLeft?k.left+=h:k.left+=r;const{style:j}=k.$el;j.transition="unset"}}}}),n.on("vertical",s=>{const{current:o,start:a,clientX:c}=n,d=c-t;g.swiper.move(d*3),t=c}),n.on("end",()=>{if(n.dir==="X"){const s=this.originlLeft-this.left;s&&g.swiper.scroll(s),this.timeouCloseResize()}});let l=0;n.on("click",s=>{this.displays=!0,this.controlbar=!1,this.timeouCloseResize(),s.timeStamp-l<300&&this.autoAlign(),l=s.timeStamp})},async onreload(){this.reload=!1,this.loading=!0,await F(),this.reload=!0,await F(),this.createApp&&this.createApp()},onIFrameLoad(e){this.loading=!1,e(this)}},async mounted(){await F(),this.initResize();let e=_[this.level];const t=V(),{options:i,app:n}=this;if(n.flex===!0){const s=_[400],o=t-this.left;o<s?e=o:e=s}this.width=e;const{style:l}=this.$el;l.opacity=0,l.width=`${e}px`,l.transition="unset",requestAnimationFrame(()=>{l.opacity=1,l.transition=""});for(const s in f){const o=f[s];o.left>=this.left&&(o.left+=e,Object.assign(o.$el.style,{transition:"",transform:`translate3d(${o.left}px, 0, 0)`}))}if(f[i.url]=this,n.src){const s=await ee(n.src);if(s.app){Object.assign(n,s.app);const{name:d,color:r,icon:h}=s.app;d&&(i.name=d),r&&(i.color=r),h&&(i.icon=h)}this.init=!0;const{level:o}=this;let a;const c={instance:this,level:o};if(s.install===void 0){const{pages:d}=s,{style:r}=n;if(d){let{paths:h}=i;h?h.shift():h=[],a={entry:s,pages:d,paths:h,style:r},this.single=!1;let b=!1;for(const k in d){const{__asyncLoader:j,inline:ce}=d[k];j?j().then(ue=>{b===!1&&ue.inline===void 0&&(b=!0,this.split=!0,this.splitSwitch=!0)}):ce===void 0&&(b=!0)}b&&(this.split=!0,this.splitSwitch=!0),Object.assign(c,qe)}else this.split=!1,Object.assign(c,s),r&&Object.assign(this.style,r);await F(),this.createApp=()=>{this.loading=!1;const h=me(c,a);h.use(Be);const b=this.$refs.mount,k=new Fe({app:h,options:i,el:b,container:this});this.router=k,h.provide("container",this),h.provide("router",k),this.pages=h.mount(b)}}else await F(),this.createApp=()=>{this.loading=!1;const d=this.$refs.mount;s.install(d,{app:this})};this.createApp()}Le(i),g.initComponentPromise&&(await g.initComponentPromise,g.initComponentPromise=void 0),Pe.emit("opened",i)}});const S=e=>(ve("data-v-07786b0a"),e=e(),ge(),e),Ue=["level"],Je={class:"view-resize"},Ke=S(()=>p("i",{class:"ficon-auto"},null,-1)),Ze=S(()=>p("i",{class:"ficon-fullscreen"},null,-1)),xe=S(()=>p("i",{class:"ficon-pages_outlined"},null,-1)),et=S(()=>p("i",{class:"ficon-fenping1"},null,-1)),tt=S(()=>p("div",{class:"view-mask",event:"mask"},null,-1)),st={class:"header item"},it={class:"title"},nt=["title"],ot=S(()=>p("i",{class:"ficon-xinchuangkou"},null,-1)),lt=[ot],at={key:1,class:"button"},rt=S(()=>p("i",{class:"ficon-up"},null,-1)),ct=[rt],ut={class:"buttons"},pt=["onClick"],ht=["title"],dt=S(()=>p("i",{class:"ficon-cha"},null,-1)),ft=[dt];function mt(e,t,i,n,l,s){const o=$("resize"),a=$("container"),c=$("IFrame"),d=$("app");return u(),v(d,{class:P({overview:e.overview})},{default:L(()=>[M(o,{ref:"resize"},null,512),p("view",{class:P({loading:e.loading}),style:R(e.style)},[e.reload?(u(),v(T,{key:0,name:"fade",appear:""},{default:L(()=>[e.app.src?(u(),m(C,{key:0},[e.init?(u(),m(C,{key:0},[e.single?(u(),v(a,{key:0,class:"mount scroll-y",level:e.level,ref:"mount",onBack:e.onclose},null,8,["level","onBack"])):(u(),m("div",{key:1,class:P(["mount",[e.split?"flat":"fixed"]]),ref:"mount",onBack:t[0]||(t[0]=(...r)=>e.onclose&&e.onclose(...r))},null,34))],64)):y("",!0)],64)):e.app.iframe?(u(),v(c,{key:1,src:e.app.iframe,gesture:e.app.gesture,onLoad:e.onIFrameLoad},null,8,["src","gesture","onLoad"])):y("",!0)]),_:1})):y("",!0),M(T,{name:"fade",appear:""},{default:L(()=>[e.maskComponent?(u(),v(Y(e.maskComponent),{key:0,context:e.context},null,8,["context"])):y("",!0)]),_:1}),p("div",{class:P({controlbar:e.controlbar,displays:e.displays}),onMouseenter:t[10]||(t[10]=(...r)=>e.clearResizeTimeouID&&e.clearResizeTimeouID(...r)),onMouseleave:t[11]||(t[11]=(...r)=>e.timeouCloseResize&&e.timeouCloseResize(...r))},[p("div",{class:"view-display",onClick:t[6]||(t[6]=(...r)=>e.closeResizeView&&e.closeResizeView(...r))},[p("div",{class:"view-levels",onClick:t[1]||(t[1]=r=>e.setLevel(r.target.getAttribute("level")))},[(u(!0),m(C,null,Q(e.levels,(r,h)=>(u(),m("div",{key:h,level:h,class:P({active:h<=e.level})},z(h)+"% ",11,Ue))),128))]),p("div",Je,[p("div",{class:"auto-resize",onClick:t[2]||(t[2]=(...r)=>e.autoScreen&&e.autoScreen(...r))},[Ke,W(" "+z(e.langs.autoScreen),1)]),p("div",{class:"full-screen",onClick:t[3]||(t[3]=(...r)=>e.fullScreen&&e.fullScreen(...r))},[Ze,W(" "+z(e.langs.fullScreen),1)])]),e.splitSwitch?(u(),m("div",{key:0,class:P(["view-mode",{split:e.split}])},[p("div",{class:"single-mode",onClick:t[4]||(t[4]=r=>e.onSplit(!1))},[xe,W(" "+z(e.langs.single),1)]),p("div",{class:"split-mode",onClick:t[5]||(t[5]=r=>e.onSplit(!0))},[et,W(" "+z(e.langs.split),1)])],2)):y("",!0)]),tt,p("div",{class:"view-drawer",onClick:t[8]||(t[8]=(...r)=>e.drawer&&e.drawer(...r))},[p("div",st,[p("div",it,[e.app.icon?(u(),m("i",{key:0,class:P(e.app.icon),style:R({color:e.app.color})},null,6)):y("",!0),p("span",null,z(e.app.name),1)]),e.controlbar?(u(),m("div",{key:0,class:"button",title:e.langs.newTab,onClick:t[7]||(t[7]=r=>e.openBlank(e.options.url))},lt,8,nt)):(u(),m("div",at,ct))]),p("div",ut,[(u(!0),m(C,null,Q(e.buttons,({name:r,icon:h,action:b})=>(u(),m("div",{class:"button",onClick:b},[p("i",{class:P(h)},null,2),p("span",null,z(r),1)],8,pt))),256))])]),p("div",{class:"bottom-line",title:e.langs.drag},null,8,ht),p("div",{class:"close",onClick:t[9]||(t[9]=J((...r)=>e.onclose&&e.onclose(...r),["stop"]))},ft)],34)],6)]),_:1},8,["class"])}const vt=O(Qe,[["render",mt],["__scopeId","data-v-07786b0a"]]),gt=D({__name:"index",setup(e){const t=w(!1),{initOptions:i}=g,{apps:n}=i;i.app&&I.push(i);const{urls:l}=n;if(l)for(const a of l){const c=te(a);c&&!I.includes(c)&&(c.paths=a.split("/"),I.push(c))}if(n.left===void 0&&(n.padding=[3,0]),G&&G.length)for(const a of G){const c=te(a);c&&!I.includes(c)&&(c.paths=a.split("/"),I.push(c))}I.length===0&&(se.value=!1);const s=w();ye(()=>{const a=s.value;g.$apps=a,Re(a),localStorage.guideState===void 0&&setTimeout(()=>t.value=!0,2e3)});function o(a){"validity"in a.target||(a.preventDefault(),Ae())}return(a,c)=>{const d=$("Guide");return u(),m(C,null,[M(T,{name:"fade"},{default:L(()=>[be(p("section",{class:P(["apps split",{control:N(B),overview:N(X)}]),ref_key:"$apps",ref:s,onContextmenu:o},[(u(!0),m(C,null,Q(N(I),r=>(u(),v(vt,{key:r.url,options:r},null,8,["options"]))),128))],34),[[$e,N(se)]])]),_:1}),M(T,{name:"fade",appear:""},{default:L(()=>[t.value?(u(),v(d,{key:0,onClose:c[0]||(c[0]=r=>t.value=!1)})):y("",!0)]),_:1})],64)}}});const St=O(gt,[["__scopeId","data-v-8024314d"]]);export{St as default};
